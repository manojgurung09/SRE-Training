# ============================================================================
# DATABASE VARIATION - POSTGRESQL
# ============================================================================
# Perfect for: Production deployments, high concurrency, large datasets
# Handles: 1M+ requests/day
# Storage: Client-server database with replication support
#
# Advantages:
#   ✅ High concurrency (many simultaneous writers)
#   ✅ Full SQL support + extensions
#   ✅ Built-in replication
#   ✅ ACID compliance
#   ✅ Industry standard
#
# Setup Options:
#   1. Self-hosted: Install PostgreSQL on server
#   2. Managed: AWS RDS, Azure Database, Google Cloud SQL
#   3. Supabase: Managed PostgreSQL with extras
# ============================================================================

DEPLOYMENT_MODE=single-vm
NODE_ENV=production

# Database - PostgreSQL
DATABASE_TYPE=postgresql
# Option 1: Connection string format
DATABASE_URL=postgresql://username:your-password-here@localhost:5432/bharatmart

# Option 2: Separate connection parameters (used by PostgreSQL adapter)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=bharatmart
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-password-here
POSTGRES_SSL=false

# SSL Configuration (for production)
DATABASE_SSL=true
DATABASE_SSL_REJECT_UNAUTHORIZED=false  # Set to true in production with valid cert

# Connection Pool
DATABASE_POOL_MIN=5
DATABASE_POOL_MAX=20
DATABASE_IDLE_TIMEOUT=30000
DATABASE_CONNECTION_TIMEOUT=2000

# Performance Tuning
DATABASE_STATEMENT_TIMEOUT=30000  # 30 seconds
DATABASE_QUERY_TIMEOUT=10000      # 10 seconds

# Read Replicas (optional, for high-read workloads)
# DATABASE_READ_REPLICA_URL=postgresql://user:pass@read-replica:5432/bharatmart

# Authentication - Local JWT
AUTH_PROVIDER=local
JWT_SECRET=your-secure-random-64-char-string-here-min-32-chars-required
JWT_EXPIRY=1h
JWT_REFRESH_EXPIRY=7d

# Other layers
WORKER_MODE=bull-queue
QUEUE_REDIS_URL=redis://localhost:6379
CACHE_TYPE=redis
CACHE_REDIS_URL=redis://localhost:6379

# Server Configuration
PORT=3000
HOST=0.0.0.0
FRONTEND_URL=https://yourdomain.com
CORS_ORIGIN=https://yourdomain.com

# Logging
LOG_LEVEL=info
LOG_FILE=/var/log/bharatmart/api.log

# Metrics
ENABLE_METRICS=true

# Frontend Configuration
VITE_API_URL=https://api.yourdomain.com
VITE_APP_NAME=BharatMart
# Note: No VITE_SUPABASE_* needed (using PostgreSQL, local auth)
# If using Supabase Auth separately, add: VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY

# Admin Seed (for db:init script)
ADMIN_EMAIL=admin@bharatmart.com
ADMIN_PASSWORD=change-this-password

# Observability
OTEL_SERVICE_NAME=bharatmart-backend
OTEL_EXPORTER_OTLP_ENDPOINT=

# Chaos Engineering (for SRE training)
CHAOS_ENABLED=false
CHAOS_LATENCY_MS=0

# PostgreSQL Setup Commands:
#
# 1. Install PostgreSQL:
#    Ubuntu: sudo apt install postgresql postgresql-contrib
#    Mac: brew install postgresql
#
# 2. Create database and user:
#    sudo -u postgres psql
#    CREATE DATABASE bharatmart;
#    CREATE USER bharatmart_user WITH PASSWORD 'secure_password';
#    GRANT ALL PRIVILEGES ON DATABASE bharatmart TO bharatmart_user;
#
# 3. Run migrations:
#    psql -U bharatmart_user -d bharatmart -f database/schema.sql
#
# 4. Enable extensions (optional):
#    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
#    CREATE EXTENSION IF NOT EXISTS "pg_stat_statements";
