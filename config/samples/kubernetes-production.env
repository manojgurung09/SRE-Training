# ============================================================================
# KUBERNETES - PRODUCTION
# ============================================================================
# Perfect for: Enterprise microservices deployment
# Setup time: 4-5 hours
# Monthly cost: $200-400
# Handles: 100,000+ users
# Architecture: Full Kubernetes with HPA, Ingress, StatefulSets
#
# Infrastructure:
#   - Kubernetes cluster (OKE, EKS, GKE, or self-managed)
#   - Horizontal Pod Autoscaler (HPA)
#   - Ingress controller with SSL
#   - StatefulSet for Redis
#   - External database (Supabase or managed PostgreSQL)
#
# Prerequisites:
#   - Kubernetes cluster running
#   - kubectl configured
#   - Helm installed (optional)
#   - Database created
#
# Setup Steps:
#   1. Create Kubernetes secret: kubectl create secret generic bharatmart-env --from-env-file=this-file
#   2. Apply deployments: kubectl apply -f deployment/kubernetes/
#   3. Configure ingress with your domain
#   4. Setup cert-manager for SSL
#
# Guide: DEPLOYMENT_QUICKSTART.md#scenario-4-kubernetes
# ============================================================================

# Deployment Configuration
DEPLOYMENT_MODE=kubernetes
NODE_ENV=production

# Database - External (Supabase or managed PostgreSQL)
DATABASE_TYPE=supabase
SUPABASE_URL=<REPLACE_WITH_YOUR_SUPABASE_URL>
SUPABASE_ANON_KEY=<REPLACE_WITH_YOUR_ANON_KEY>
SUPABASE_SERVICE_ROLE_KEY=<REPLACE_WITH_YOUR_SERVICE_ROLE_KEY>
DATABASE_POOL_MIN=10
DATABASE_POOL_MAX=50

# Alternative: Managed PostgreSQL
# DATABASE_TYPE=postgresql
# DATABASE_URL=postgresql://user:pass@postgres.namespace.svc.cluster.local:5432/bharatmart

# Authentication
AUTH_PROVIDER=supabase

# Workers - Bull Queue with Redis StatefulSet
WORKER_MODE=bull-queue
WORKER_CONCURRENCY=10
QUEUE_REDIS_URL=redis://redis-master.bharatmart.svc.cluster.local:6379
QUEUE_PREFIX=bharatmart:queue
QUEUE_ATTEMPTS=3
QUEUE_BACKOFF_DELAY=5000

# Cache - Redis StatefulSet
CACHE_TYPE=redis
CACHE_REDIS_URL=redis://redis-master.bharatmart.svc.cluster.local:6379
CACHE_TTL=600
CACHE_PREFIX=bharatmart:cache

# Secrets Management - Kubernetes Secrets
SECRETS_PROVIDER=env

# Server Configuration
PORT=3000
HOST=0.0.0.0
FRONTEND_URL=https://yourdomain.com

# Security
JWT_SECRET=<STORED_IN_K8S_SECRET>
CORS_ORIGIN=https://yourdomain.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=1000

# Logging - Structured JSON for log aggregation
LOG_LEVEL=info
LOG_FORMAT=json

# Metrics - Prometheus scraping
ENABLE_METRICS=true
METRICS_PORT=9090
METRICS_PATH=/metrics

# Health Checks - For K8s probes
HEALTH_CHECK_PATH=/api/health
READINESS_CHECK_PATH=/api/health/ready
LIVENESS_CHECK_PATH=/api/health

# Kubernetes-specific
POD_NAME=${HOSTNAME}
POD_NAMESPACE=bharatmart
POD_IP=${POD_IP}

# Horizontal Pod Autoscaler hints
TARGET_CPU_UTILIZATION=70
TARGET_MEMORY_UTILIZATION=80
MIN_REPLICAS=3
MAX_REPLICAS=20

# Frontend Configuration
VITE_API_URL=https://api.yourdomain.com
VITE_APP_NAME=BharatMart
VITE_SUPABASE_URL=<REPLACE_WITH_YOUR_SUPABASE_URL>
VITE_SUPABASE_ANON_KEY=<REPLACE_WITH_YOUR_ANON_KEY>

# Email Configuration
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=<REPLACE_THIS>
SMTP_PASSWORD=<STORED_IN_K8S_SECRET>
EMAIL_FROM=noreply@yourdomain.com

# Observability
OTEL_SERVICE_NAME=bharatmart-backend
OTEL_EXPORTER_OTLP_ENDPOINT=http://opentelemetry-collector:4318/v1/traces
OTEL_TRACES_SAMPLER=always_on

# Chaos Engineering (disabled for production, enable for SRE training)
CHAOS_ENABLED=false
CHAOS_LATENCY_MS=0

# Admin Seed (for db:init script)
ADMIN_EMAIL=admin@bharatmart.com
ADMIN_PASSWORD=<STORED_IN_K8S_SECRET>

# Monitoring & Observability
SENTRY_DSN=<REPLACE_WITH_SENTRY_DSN>
JAEGER_ENDPOINT=http://jaeger-collector:14268/api/traces
ENABLE_TRACING=true

# Service Mesh (if using Istio/Linkerd)
# SERVICE_MESH=istio
# MESH_NAMESPACE=istio-system
