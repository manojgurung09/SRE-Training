# ============================================================================
# MULTI-VM - SUPABASE DATABASE
# ============================================================================
# Perfect for: Scalable production with managed database
# Setup time: 2 hours
# Monthly cost: $100-200
# Handles: 10,000-100,000 users
# Architecture: Separate VMs for backend, workers, cache
#
# Infrastructure:
#   - Load Balancer (OCI/AWS/Azure)
#   - Backend API: 2-10 VMs (auto-scaling)
#   - Workers: 2-20 VMs (queue-based scaling)
#   - Redis: 1-3 VMs (or managed Redis)
#   - Database: Supabase (managed)
#
# Setup Steps:
#   1. Create Supabase project
#   2. Setup Redis cluster or managed Redis
#   3. Deploy backend VMs with this config
#   4. Deploy worker VMs with WORKER_TYPE set
#   5. Configure load balancer
#
# Guide: DEPLOYMENT_QUICKSTART.md#scenario-3-oci-multi-tier
# ============================================================================

# Deployment Configuration
DEPLOYMENT_MODE=multi-tier
NODE_ENV=production

# Database - Supabase (Managed)
DATABASE_TYPE=supabase
SUPABASE_URL=<REPLACE_WITH_YOUR_SUPABASE_URL>
SUPABASE_ANON_KEY=<REPLACE_WITH_YOUR_ANON_KEY>
SUPABASE_SERVICE_ROLE_KEY=<REPLACE_WITH_YOUR_SERVICE_ROLE_KEY>
DATABASE_POOL_MIN=5
DATABASE_POOL_MAX=20

# Authentication
AUTH_PROVIDER=supabase

# Workers - Bull Queue with Redis Cluster
WORKER_MODE=bull-queue
WORKER_CONCURRENCY=10
QUEUE_REDIS_URL=redis://redis-cluster.internal:6379
QUEUE_PREFIX=bharatmart:queue
QUEUE_ATTEMPTS=3
QUEUE_BACKOFF_DELAY=5000
QUEUE_REMOVE_ON_COMPLETE=100
QUEUE_REMOVE_ON_FAIL=1000

# For Worker VMs: Set one of these
# WORKER_TYPE=email     # Email worker
# WORKER_TYPE=order     # Order worker
# WORKER_TYPE=payment   # Payment worker
# WORKER_TYPE=all       # All workers (default)

# Cache - Redis Cluster
CACHE_TYPE=redis
CACHE_REDIS_URL=redis://redis-cluster.internal:6379
CACHE_TTL=600
CACHE_PREFIX=bharatmart:cache

# Secrets Management
SECRETS_PROVIDER=env

# Server Configuration
PORT=3000
HOST=0.0.0.0
FRONTEND_URL=https://yourdomain.com

# Security
JWT_SECRET=<REPLACE_WITH_SECURE_RANDOM_64_CHAR_STRING>
CORS_ORIGIN=https://yourdomain.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=1000

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE=/var/log/bharatmart/api.log

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# Health Checks
HEALTH_CHECK_PATH=/api/health
READINESS_CHECK_PATH=/api/health/ready

# Frontend Configuration
VITE_API_URL=https://api.yourdomain.com
VITE_APP_NAME=BharatMart
VITE_SUPABASE_URL=<REPLACE_WITH_YOUR_SUPABASE_URL>
VITE_SUPABASE_ANON_KEY=<REPLACE_WITH_YOUR_ANON_KEY>

# Email Configuration
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=<REPLACE_THIS>
SMTP_PASSWORD=<REPLACE_THIS>
EMAIL_FROM=noreply@yourdomain.com

# Observability
OTEL_SERVICE_NAME=bharatmart-backend
OTEL_EXPORTER_OTLP_ENDPOINT=<OPTIONAL_OTLP_ENDPOINT>
OTEL_TRACES_SAMPLER=always_on

# Chaos Engineering (disabled for production, enable for SRE training)
CHAOS_ENABLED=false
CHAOS_LATENCY_MS=0

# Admin Seed (for db:init script)
ADMIN_EMAIL=admin@bharatmart.com
ADMIN_PASSWORD=<REPLACE_THIS>

# Monitoring
SENTRY_DSN=<REPLACE_WITH_SENTRY_DSN>
DATADOG_API_KEY=<OPTIONAL_DATADOG_KEY>

# Auto-Scaling Hints (for monitoring)
SCALE_UP_CPU_THRESHOLD=70
SCALE_DOWN_CPU_THRESHOLD=30
SCALE_UP_QUEUE_THRESHOLD=100
