# ============================================================================
# CACHE VARIATION - REDIS CLUSTER
# ============================================================================
# Perfect for: High-availability caching, distributed systems
# Features: Automatic failover, data sharding, replication
#
# Advantages:
#   ✅ High availability (automatic failover)
#   ✅ Horizontal scaling (add more nodes)
#   ✅ Data partitioning (sharding)
#   ✅ Better performance under high load
#   ✅ No single point of failure
#
# Use Cases:
#   - Multi-VM deployments
#   - High-traffic applications
#   - Need for 99.9%+ uptime
#   - Large cache datasets (100GB+)
# ============================================================================

DEPLOYMENT_MODE=multi-tier
NODE_ENV=production

# Database
DATABASE_TYPE=supabase
SUPABASE_URL=<REPLACE_THIS>
SUPABASE_ANON_KEY=<REPLACE_THIS>

# Cache - Redis Cluster
CACHE_TYPE=redis-cluster

# Redis Cluster Nodes (comma-separated)
CACHE_REDIS_CLUSTER_NODES=redis-node1:6379,redis-node2:6379,redis-node3:6379,redis-node4:6379,redis-node5:6379,redis-node6:6379

# Or individual node configuration
# CACHE_REDIS_NODE_1=redis-node1.internal:6379
# CACHE_REDIS_NODE_2=redis-node2.internal:6379
# CACHE_REDIS_NODE_3=redis-node3.internal:6379
# CACHE_REDIS_NODE_4=redis-node4.internal:6379
# CACHE_REDIS_NODE_5=redis-node5.internal:6379
# CACHE_REDIS_NODE_6=redis-node6.internal:6379

# Cluster Configuration
CACHE_REDIS_PASSWORD=<REPLACE_IF_AUTH_ENABLED>
CACHE_CLUSTER_RETRY_STRATEGY=exponential
CACHE_MAX_REDIRECTIONS=16
CACHE_RETRY_DELAY=100

# Cache Settings
CACHE_TTL=600                     # Default TTL: 10 minutes
CACHE_PREFIX=bharatmart:cache
CACHE_MAX_MEMORY_POLICY=allkeys-lru  # Eviction policy

# Cache Strategies
CACHE_PRODUCT_TTL=3600            # Products: 1 hour
CACHE_ORDER_TTL=300               # Orders: 5 minutes
CACHE_USER_TTL=1800               # Users: 30 minutes
CACHE_SESSION_TTL=86400           # Sessions: 24 hours

# Performance Tuning
CACHE_POOL_MIN=10
CACHE_POOL_MAX=50
CACHE_CONNECT_TIMEOUT=5000
CACHE_COMMAND_TIMEOUT=3000

# Monitoring
CACHE_ENABLE_METRICS=true
CACHE_SLOW_LOG_THRESHOLD=100      # Log queries slower than 100ms

# Fallback to in-memory cache if Redis unavailable
CACHE_FALLBACK_TO_MEMORY=true

# Authentication
AUTH_PROVIDER=supabase
JWT_SECRET=<REPLACE_WITH_SECURE_RANDOM_64_CHAR_STRING>
SUPABASE_SERVICE_ROLE_KEY=<REPLACE_THIS>

# Workers - Bull Queue with Redis Cluster
WORKER_MODE=bull-queue
WORKER_CONCURRENCY=10
QUEUE_REDIS_URL=redis://redis-node1:6379
QUEUE_PREFIX=bharatmart:queue

# Secrets Management
SECRETS_PROVIDER=env

# Server Configuration
PORT=3000
HOST=0.0.0.0
FRONTEND_URL=https://yourdomain.com
CORS_ORIGIN=https://yourdomain.com

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE=/var/log/bharatmart/api.log

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# Observability
OTEL_SERVICE_NAME=bharatmart-backend
OTEL_EXPORTER_OTLP_ENDPOINT=<OPTIONAL_OTLP_ENDPOINT>
OTEL_TRACES_SAMPLER=always_on

# Chaos Engineering (for SRE training)
CHAOS_ENABLED=false
CHAOS_LATENCY_MS=0

# Frontend Configuration
VITE_API_URL=https://api.yourdomain.com
VITE_APP_NAME=BharatMart
VITE_SUPABASE_URL=<REPLACE_THIS>
VITE_SUPABASE_ANON_KEY=<REPLACE_THIS>

# Admin Seed (for db:init script)
ADMIN_EMAIL=admin@bharatmart.com
ADMIN_PASSWORD=<REPLACE_THIS>

# Redis Cluster Setup:
#
# Minimum: 6 nodes (3 masters + 3 replicas)
#
# 1. Install Redis on each node:
#    sudo apt install redis-server
#
# 2. Configure each node (/etc/redis/redis.conf):
#    port 6379
#    cluster-enabled yes
#    cluster-config-file nodes.conf
#    cluster-node-timeout 5000
#    appendonly yes
#
# 3. Start Redis on all nodes:
#    sudo systemctl start redis
#
# 4. Create cluster:
#    redis-cli --cluster create \
#      node1:6379 node2:6379 node3:6379 \
#      node4:6379 node5:6379 node6:6379 \
#      --cluster-replicas 1
#
# 5. Verify cluster:
#    redis-cli -c -h node1 cluster info
#
# Alternative: Use managed Redis cluster:
#   - AWS ElastiCache
#   - Azure Cache for Redis
#   - OCI Cache
#   - Redis Enterprise Cloud
