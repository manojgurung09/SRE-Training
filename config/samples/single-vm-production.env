# ============================================================================
# SINGLE VM - PRODUCTION (With Redis)
# ============================================================================
# Perfect for: Production deployments with background jobs
# Setup time: 1 hour
# Monthly cost: $50-100
# Handles: 1,000-10,000 users
# External services: Supabase + Local Redis
#
# Prerequisites:
#   - Ubuntu 22.04 VM with 4GB RAM, 2 vCPUs
#   - Supabase account
#   - Domain with SSL certificate
#   - Redis installed on VM
#
# Setup Steps:
#   1. Install Redis: sudo apt install redis-server
#   2. Start Redis: sudo systemctl start redis
#   3. Create Supabase project and run migrations
#   4. Copy this file to server and configure
#   5. Deploy: ./deployment/scripts/deploy-backend-oci.sh
#   6. Start worker: pm2 start server/workers/index.js --name worker
#
# Guide: DEPLOYMENT_QUICKSTART.md#scenario-2-single-vm-production
# ============================================================================

# Deployment Configuration
DEPLOYMENT_MODE=single-vm
NODE_ENV=production

# Database - Supabase
DATABASE_TYPE=supabase
SUPABASE_URL=<REPLACE_WITH_YOUR_SUPABASE_URL>
SUPABASE_ANON_KEY=<REPLACE_WITH_YOUR_ANON_KEY>
SUPABASE_SERVICE_ROLE_KEY=<REPLACE_WITH_YOUR_SERVICE_ROLE_KEY>

# Authentication
AUTH_PROVIDER=supabase

# Workers - Bull Queue with Redis (production-ready)
WORKER_MODE=bull-queue
WORKER_CONCURRENCY=5
QUEUE_REDIS_URL=redis://localhost:6379
QUEUE_PREFIX=bharatmart:queue
QUEUE_ATTEMPTS=3
QUEUE_BACKOFF_DELAY=5000

# Cache - Redis (shared across restarts)
CACHE_TYPE=redis
CACHE_REDIS_URL=redis://localhost:6379
CACHE_TTL=600
CACHE_PREFIX=bharatmart:cache

# Secrets Management
SECRETS_PROVIDER=env

# Server Configuration
PORT=3000
HOST=0.0.0.0
FRONTEND_URL=https://yourdomain.com

# Security
JWT_SECRET=<REPLACE_WITH_SECURE_RANDOM_64_CHAR_STRING>
CORS_ORIGIN=https://yourdomain.com
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Logging
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE=/var/log/bharatmart/api.log

# Metrics
ENABLE_METRICS=true
# DO NOT set METRICS_PORT (uses same 3000 via /metrics)

# Frontend Configuration
VITE_API_URL=https://api.yourdomain.com
VITE_APP_NAME=BharatMart
VITE_SUPABASE_URL=<REPLACE_WITH_YOUR_SUPABASE_URL>
VITE_SUPABASE_ANON_KEY=<REPLACE_WITH_YOUR_ANON_KEY>

# Email Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=<REPLACE_THIS>
SMTP_PASSWORD=<REPLACE_THIS>
EMAIL_FROM=noreply@yourdomain.com

# Admin Seed (for db:init script)
ADMIN_EMAIL=admin@bharatmart.com
ADMIN_PASSWORD=change-this-password

# Observability
OTEL_SERVICE_NAME=bharatmart-backend
OTEL_EXPORTER_OTLP_ENDPOINT=
OTEL_TRACES_SAMPLER=always_on

# Chaos Engineering (for SRE training)
CHAOS_ENABLED=false
CHAOS_LATENCY_MS=0

# Monitoring (optional)
SENTRY_DSN=<OPTIONAL_SENTRY_URL>
