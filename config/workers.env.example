# ============================================================================
# Queue Workers Configuration
# ============================================================================
# Copy this to .env for worker deployment
# This file matches the structure used in prd.env and actual code implementation
# ============================================================================

# ===== CORE ENV =====
NODE_ENV=production

# ===== WORKER CONFIGURATION =====
# Worker type: email | order | payment | all
WORKER_TYPE=all
WORKER_CONCURRENCY=5
WORKER_NAME=bharatmart-worker

# Worker mode (must match backend WORKER_MODE)
# Options: in-process | bull-queue | oci-queue | sqs | none
WORKER_MODE=bull-queue

# ===== LAYER 2: API CONNECTION (Optional) =====
# Backend API URL (if workers need to call API)
API_BASE_URL=http://backend-host:3000
API_KEY=your-internal-api-key

# ===== LAYER 3: DATABASE CONNECTION =====
# Supabase Configuration
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your-supabase-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key-here

# PostgreSQL Direct Connection (optional, if DATABASE_TYPE=postgresql)
# DATABASE_URL=postgresql://user:password@db-host:5432/database
# DATABASE_POOL_SIZE=10

# ===== LAYER 4: CACHE CONNECTION (Optional) =====
# Redis Cache (if workers need caching)
# Note: server/adapters/cache/redis.ts uses CACHE_REDIS_URL
CACHE_REDIS_URL=redis://cache-host:6379
CACHE_REDIS_PASSWORD=your-redis-password
CACHE_REDIS_DB=0

# ===== LAYER 5: QUEUE CONNECTION =====
# Queue Redis Configuration (REQUIRED for bull-queue mode)
# Note: server/adapters/workers/bull-queue.ts uses QUEUE_REDIS_URL
QUEUE_REDIS_URL=redis://queue-host:6379
QUEUE_REDIS_PASSWORD=your-queue-password
QUEUE_REDIS_DB=1
QUEUE_REDIS_TLS_ENABLED=false

# Legacy: server/config/queue.ts uses REDIS_URL (fallback)
# REDIS_URL=redis://queue-host:6379

# Queue Job Settings
JOB_ATTEMPTS=3
JOB_BACKOFF_TYPE=exponential
JOB_BACKOFF_DELAY=2000
JOB_TIMEOUT=30000

# ===== LAYER 6: MONITORING CONNECTION =====
# Metrics (if workers expose metrics)
METRICS_ENABLED=true
METRICS_PORT=9090
METRICS_PREFIX=bharatmart_worker

# ===== EXTERNAL SERVICES =====
# Email Service (for email worker)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-email@example.com
SMTP_PASSWORD=your-email-password
FROM_EMAIL=noreply@yourdomain.com

# Payment Gateway (for payment worker)
# PAYMENT_GATEWAY_URL=https://payment-gateway.com/api
# PAYMENT_API_KEY=your-payment-api-key

# ===== LOGGING CONFIGURATION =====
LOG_LEVEL=info
LOG_FORMAT=json
LOG_FILE=/var/log/bharatmart/worker.log

# ===== SCALING CONFIGURATION =====
# Number of concurrent jobs per worker
MAX_CONCURRENT_JOBS=5

# Queue processing strategy
QUEUE_LIMITER_MAX=10
QUEUE_LIMITER_DURATION=1000

# Graceful shutdown timeout
SHUTDOWN_TIMEOUT=30000

# ===== HEALTH CHECK CONFIGURATION =====
HEALTH_CHECK_INTERVAL=60000
QUEUE_HEALTH_THRESHOLD=1000
