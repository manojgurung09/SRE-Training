# ============================================================================
# Backend API Configuration (Express.js)
# ============================================================================
# Copy this to .env for backend deployment
# This file matches the structure used in prd.env and actual code implementation
# ============================================================================

# ===== CORE =====
NODE_ENV=development
DEPLOYMENT_MODE=local

# ===== DATABASE (SUPABASE CLOUD) =====
DATABASE_TYPE=supabase
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your-supabase-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key-here

# PostgreSQL Direct Connection (optional, if DATABASE_TYPE=postgresql)
# DATABASE_URL=postgresql://username:your-password-here@db-host:5432/database
# DATABASE_POOL_SIZE=20
# DATABASE_TIMEOUT=30000

# ===== AUTH =====
AUTH_PROVIDER=supabase
JWT_SECRET=dev-local-secret-change-later

# ===== SERVER =====
PORT=3000
HOST=0.0.0.0
FRONTEND_URL=http://40.81.230.114:5173/
CORS_ORIGIN=*

# ===== WORKERS =====
# Options: in-process | bull-queue | oci-queue | sqs | none
WORKER_MODE=none
WORKER_CONCURRENCY=5

# Queue Redis Configuration (required if WORKER_MODE=bull-queue)
# Note: server/config/queue.ts uses REDIS_URL, but adapters use QUEUE_REDIS_URL
# For Bull Queue workers, use QUEUE_REDIS_URL
QUEUE_REDIS_URL=
# For legacy compatibility, REDIS_URL is also checked
REDIS_URL=

# ===== CACHE =====
# Options: memory | redis | oci-cache | memcached
CACHE_TYPE=memory

# Redis Cache Configuration (required if CACHE_TYPE=redis)
# Note: server/adapters/cache/redis.ts uses CACHE_REDIS_URL
CACHE_REDIS_URL=
# OCI Cache (if CACHE_TYPE=oci-cache)
# OCI_CACHE_ENDPOINT=

# Legacy: server/config/redis.ts uses REDIS_URL (fallback)
# REDIS_URL=redis://localhost:6379

# Cache TTL (seconds)
CACHE_TTL=300

# ===== LOGGING =====
LOG_LEVEL=debug
LOG_FORMAT=json
LOG_FILE=./logs/api.log

# ===== METRICS =====
ENABLE_METRICS=true
# DO NOT set METRICS_PORT (uses same 3000 via /metrics)

# ===== OBSERVABILITY =====
# OpenTelemetry Tracing
OTEL_SERVICE_NAME=bharatmart-backend
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318/v1/traces
OTEL_TRACES_SAMPLER=always_on

# ===== CHAOS ENGINEERING =====
# For SRE training - enable chaos injection
CHAOS_ENABLED=false
CHAOS_LATENCY_MS=0

# ===== SECURITY =====
# Session and API Security
SESSION_SECRET=your-session-secret-here
API_KEY=your-internal-api-key

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# ===== DEPLOYMENT CONFIGURATION =====
# Secrets Provider: env | oci-vault | aws-secrets | azure-keyvault
SECRETS_PROVIDER=env

# Config Provider: env | oci-app-config | aws-appconfig
CONFIG_PROVIDER=env

# ===== SCALING CONFIGURATION =====
# Cluster mode (for multi-core scaling)
CLUSTER_MODE=false
WORKER_PROCESSES=auto

# Connection Pool Sizes
MAX_CONNECTIONS_PER_INSTANCE=100
KEEP_ALIVE_TIMEOUT=65000

# ===== HEALTH CHECK CONFIGURATION =====
HEALTH_CHECK_INTERVAL=30000
READY_CHECK_TIMEOUT=5000

# ===== ADMIN USER (for db:init script) =====
ADMIN_EMAIL=admin@bharatmart.com
ADMIN_PASSWORD=Admin@123
